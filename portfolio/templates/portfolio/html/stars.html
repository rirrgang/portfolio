<canvas class="threejs-canvas-fs" id="stars"></canvas>

<script type="module">
    import * as THREE from 'three';
    $(document).ready(function () {
        var width = $(document.body).width();//window.innerWidth ;
        var height = $(document.body).height();//window.innerHeight;
        var myCanvas = document.getElementById("stars");
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, width / height, 0.1, 1000);

        const renderer = new THREE.WebGLRenderer({
            alpha: true,
            antialias: true,
            canvas: myCanvas,
        });
        renderer.setSize(width, height);
        $(document.body).prepend(renderer.domElement);


        starGeo = new THREE.Geometry();
        for (let i = 0; i < 6000; i++) {
            let star = new THREE.Vector3(
                Math.random() * 600 - 300,
                Math.random() * 600 - 300,
                Math.random() * 600 - 300
            );
            star.velocity = 0;
            star.acceleration = 0.002;
            starGeo.vertices.push(star);
        }

        let sprite = new THREE.TextureLoader().load('/static/portfolio/pictures/white-star-icon.png');
        let starMaterial = new THREE.PointsMaterial({
            color: 0xaaaaaa,
            size: 0.7,
            map: sprite
        });
        stars = new THREE.Points(starGeo, starMaterial);
        scene.add(stars);

        camera.position.z = 1;
        camera.rotation.x = Math.PI / 2;

        function animate() {
            starGeo.vertices.forEach(p => {
                p.velocity += p.acceleration
                p.y -= p.velocity;

                if (p.y < -200) {
                    p.y = 200;
                    p.velocity = 0;
                }
            });
            starGeo.verticesNeedUpdate = true;
            stars.rotation.y += 0.002;

            requestAnimationFrame(animate);

            renderer.render(scene, camera);
        };

        animate();

        window.addEventListener('resize', onWindowResize);

        function onWindowResize() {
            width = $(document.body).width();//window.innerWidth ;
            height = $(document.body).height();//window.innerHeight;
            camera.aspect = width / height;
            //camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();

            //renderer.setSize( window.innerWidth, window.innerHeight );
            renderer.setSize(width, height);

        }

        const cursor = {}
        cursor.x = 0
        cursor.y = 0

        //Paralax
        // window.addEventListener('mousemove', (event) => {
        //     width = $(document.body).width();//window.innerWidth ;
        //     height = $(document.body).height();//window.innerHeight;
        //     cursor.x = event.clientX / width - 0.5
        //     cursor.y = event.clientY / height - 0.5
        //     const parallaxX = cursor.x
        //     const parallaxY = -cursor.y
        //     camera.position.x = parallaxX *5
        //     camera.position.z = parallaxY * 5

        //     //console.log(cursor)
        // })
    });
</script>