<canvas class="threejs-canvas-fs" id="stars"></canvas>

<script type="module">
    import * as THREE from 'three';
    $(document).ready(function () {
        var width = $(document.body).width();//window.innerWidth ;
        var height = $(document.body).height();//window.innerHeight;
        var myCanvas = document.getElementById("stars");
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, width / height, 0.1, 1000);

        camera.position.z = 1;
        camera.rotation.x = Math.PI / 2;

        let starGeo, particleSystem;

        const renderer = new THREE.WebGLRenderer({
            alpha: true,
            antialias: true,
            canvas: myCanvas,
        });
        renderer.setSize(width, height);
        $(document.body).prepend(renderer.domElement);


        //-----------------------------------------------STARS TEXTURE--------------------------------------------------------
        let starSprite = new THREE.TextureLoader().load('/static/portfolio/pictures/white-star-icon.png');
        let starAlphaSprite = new THREE.TextureLoader().load('/static/portfolio/pictures/white-star-icon-alpha.png');
        let starMaterial = new THREE.PointsMaterial({
            //color: 0xaaaaaa,
            size: 0.7,
            map: starSprite,
            alphaMap: starAlphaSprite
        });

        //-----------------------------------------------STARS GEOMETRY--------------------------------------------------------
        starGeo = new THREE.BufferGeometry();
        const positions = [];
        const particles = 10000;
        const radius = 200;
        const velocities = [];
        const accelerations = [];

        for (let i = 0; i < particles; i++) {
            positions.push((Math.random() * 2 - 1) * radius);
            positions.push((Math.random() * 2 - 1) * radius);
            positions.push((Math.random() * 2 - 1) * radius);
            velocities.push(0);
            accelerations.push(0.002); //initial acceleration multiplier
        }

        starGeo.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));
        particleSystem = new THREE.Points(starGeo, starMaterial);
        scene.add(particleSystem);


        //-----------------------------------------------STARS ANIMATION--------------------------------------------------------
        function animate() {
            const positionAttribute = starGeo.getAttribute('position');

            for (let i = 0; i < positionAttribute.count; i++) {

                var posY = positionAttribute.getY(i);
                var vel = velocities[i];
                const accel = accelerations[i];

                vel += accel;
                posY -= vel;

                if (posY < -200) {
                    posY = 200;
                    vel = 0;
                }

                velocities[i] = vel;
                positionAttribute.setY(i, posY);
            }
            particleSystem.rotation.y += 0.002;
            positionAttribute.needsUpdate = true;

            requestAnimationFrame(animate);

            renderer.render(scene, camera);
        };

        animate();


        //-----------------------------------------------RESIZE FUNCTION--------------------------------------------------------
        window.addEventListener('resize', onWindowResize);

        function onWindowResize() {
            width = $(document.body).width();//window.innerWidth ;
            height = $(document.body).height();//window.innerHeight;
            camera.aspect = width / height;
            //camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();

            //renderer.setSize( window.innerWidth, window.innerHeight );
            renderer.setSize(width, height);

        }

        const cursor = {}
        cursor.x = 0
        cursor.y = 0

        //Paralax
        // window.addEventListener('mousemove', (event) => {
        //     width = $(document.body).width();//window.innerWidth ;
        //     height = $(document.body).height();//window.innerHeight;
        //     cursor.x = event.clientX / width - 0.5
        //     cursor.y = event.clientY / height - 0.5
        //     const parallaxX = cursor.x
        //     const parallaxY = -cursor.y
        //     camera.position.x = parallaxX *5
        //     camera.position.z = parallaxY * 5

        //     //console.log(cursor)
        // })
    });
</script>